---
title: "Reactã§ã€Featuresã«ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æŒãŸãªã„ã‚ˆã†ã«ã—ã¦ã¿ãŸ"
emoji: "ğŸ‘»"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics:
  ["react", "javascript", "typescript", "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰", "ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£"]
published: true
---

### å‰æ

- bulletproof-react ã‚’åŸºæº–ã«ã—ã¦ã„ã‚‹ã“ã¨
- tanstack-router ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- react-hook-form ã¨ zod ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- shadcn(UI ãƒ©ã‚¤ãƒ–ãƒ©ãƒª)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã“ã¨
- ç­†è€…è‡ªèº«ã«æŠ€è¡“åŠ›ã‚’æœŸå¾…ã—ãªã„ã“ã¨

# ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³

ã„ã¤ã‚‚æ‚©ã‚“ã§ã„ãŸã®ãŒã€pages ã¨ features ä¸¡æ–¹ã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆä»¥ä¸‹ã‚¹ã‚¿ã‚¤ãƒ«ï¼‰ã‚’é©å¿œã—ã¦ã„ãŸã€‚features ã¯ã€form ã‚¿ã‚°ã®ä¸­èº«ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚‚é©å¿œã•ã›ã‚‹å½¢ã«ã—ã¦ã„ãŸã€‚
2024 å¹´ 9 æœˆã‚ãŸã‚Šã§ã€SOLID åŸå‰‡ã«ã¤ã„ã¦æ”¹ã‚ã¦è§¦ã‚Œã‚‹æ©Ÿä¼šãŒã‚ã‚Šã€
ãµã¨ã€ã€Œå˜ä¸€è²¬ä»»ã‚’è€ƒãˆã‚‹ã®ã§ã‚ã‚Œã°ã‚¹ã‚¿ã‚¤ãƒ«ã®é©å¿œã¯ä¸€ç®‡æ‰€ãŒã„ã„ãªã€ã¨æ€ã„ã€
pages ã®ä¸­ã«ã¾ã¨ã‚ã‚‹å½¢ã‚’æ§‹ç¯‰ã—ãŸã„ã¨å‹•ãå‡ºã—ãŸã€‚

ã•ã‚‰ã«ã¯ã€ã“ã®è¨˜äº‹ã®å†…å®¹ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã•ã›ã¦ã€è‰¯ã„æ„Ÿã˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã‚ŠãŸã„ã¨æ€ã£ã¦ã„ã‚‹ã€‚

## ã‚„ã£ãŸã“ã¨

ã‚¿ã‚¤ãƒˆãƒ«ã®é€šã‚Šã€features é…ä¸‹ã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©å¿œã•ã›ãšã€
pages é…ä¸‹ã§ã€ãƒ•ã‚©ãƒ¼ãƒ ã® input ã‚„ select ã® UI ãƒ‘ãƒ¼ãƒ„ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚ˆã†ã«æ§‹ç¯‰ã—ãŸã€‚

```pages/login.tsx
export const LoginPage: FC<{}> = () => {
  const navigate = useNavigate();
  const onSuccess = () => {
    navigate({
      to: "/app",
    });
  };

  return (
    <>
      <LoginForm onSuccess={onSuccess}>
        {(fields) => (
          <>
            {fields.username}
            {fields.password}
            <Button type="submit">Login</Button>
          </>
        )}
      </LoginForm>
    </>
  );
};
```

```features/auth/LoginForm.tsx
type FormValues = {
  username: string;
  password: string;
};

export const LoginForm: FC<FormFeatureProp<FormValues>> = ({
  onSuccess,
  ...props
}) => {
  const mutation = useLogin({
    onSuccess,
  });
  const onSubmit = (values: FormValues) => {
    mutation.mutate(values);
  };

  const fieldModel: ArgsModelType<FormValues> = {
    username: {
      field: FieldType.Input,
      fieldOptions: {
        label: "username",
      },
    },
    password: {
      field: FieldType.Input,
      fieldOptions: {
        type: "password",
        label: "password",
      },
    },
  };

  const validator: Record<keyof FormValues, any> = {
    username: z.string({
      message: MESSAGE.REQUIRED,
    }),
    password: z.string({
      message: MESSAGE.REQUIRED,
    }),
  };

  return (
    <Form<FormValues>
      onSubmit={onSubmit}
      fieldModel={fieldModel}
      validator={validator}
      {...props}
    />
  );
};
```

```Form.tsx

export type FormFeatureProp<TFormValues> = {
  onSuccess: () => void;
  keys?: FieldSchemaKey<TFormValues>;
  children: (fields: RenderFieldsType<TFormValues>) => React.ReactNode;};


export const Form = ({
    ...
  fieldModel,
  validator,
  keys,
  debug = false,
}: FormProps<TFormValues>) => {

...

  const { model, schema } = getModelSchema<TFormValues>({
    fieldModel,
    validator,
    keys,
  });

  const methods = useForm<TFormValues>({
    ...options,
    resolver: schema && zodResolver(schema),
  });

  const fields = getFields({ control: methods.control, model });

...

  return (
    <UIForm {...methods}>
      <form>
        {children(fields)}
      </form>
    </UIForm>
  );
};
```

```utils/modelSchema.tsx
export type FieldSchemaKey<TFormValues> = (keyof TFormValues)[];

export type ModelSchemaType<TFormValues> = {
  fieldModel: ArgsModelType<TFormValues>;
  validator: Record<keyof TFormValues, ZodFirstPartySchemaTypes>;
  keys?: FieldSchemaKey<TFormValues>;
};

export const getModelSchema = <TFormValues extends Record<string, unknown>>({
  fieldModel,
  validator,
  keys,
}: ModelSchemaType<TFormValues>) => {

  // defineModelã¯å¼•æ•°ã‚’è¿”ã™ã ã‘
  const definedModel = defineModel(
    filterObject<typeof fieldModel>(fieldModel, keys)
  );
  const schema = z.object(filterObject<typeof validator>(validator, keys));

  return {
    model: definedModel,
    schema,
  };
};
```

```utils/FieldModel.tsx
export type RenderFieldsType<T> = {
  [K in keyof T]: React.ReactNode;
};

interface GetFieldsProps<T extends FieldValues> {
  model: ArgsModelType<T>;
  control: Control<T>;
}

export const getFields = <TFormValues extends FieldValues>({
  model,
  control,
}: GetFieldsProps<TFormValues>): RenderFieldsType<TFormValues> => {
  const keys = Object.keys(model);

  const fields = keys.reduce((prev, key) => {
    const Field = getField(model[key].field);
    if (!Field) {
      return {
        ...prev,
        [key]: null,
      };
    }

    const fieldOptions = model[key].fieldOptions ?? {};

    return {
      ...prev,
      [key]: (
        <FormField
          control={control}
          name={key as Path<TFormValues>}
          render={({ field }) => <Field {...fieldOptions} {...field} />}
        />
      ),
    };
  }, {});

  return fields as RenderFieldsType<TFormValues>;
};

```

```type.d.ts
export type FieldOptions<TField> = typeof TField extends FieldType.Input
  ? InputFieldProps
  : typeof TField extends FieldType.TextArea
    ? TextAreaFieldProps
    : typeof TField extends FieldType.Select
      ? SelectFieldProps
      : never;

export type ModelType = {
  field: FieldType;
  fieldOptions?: FieldOptions<ModelType["field"]>;
};

export type ArgsModelType<T> = {
  [K in keyof T]: ModelType;
};
```

### ãƒ•ã‚©ãƒ¼ãƒ ã®è¦ç´ ã‚’æ¸›ã‚‰ã™å ´åˆ

keys ã‚’è¿½åŠ ã™ã‚‹ã ã‘ã€‚
keys ã®è¦ç´ ã«é–¢ã—ã¦ã¯ã€å‹ãƒã‚§ãƒƒã‚¯ã§ãã¦ã‚‹ã€‚
FromValues ã«å®šç¾©ã—ãŸ key ã—ã‹å…¥ã‚Œã‚‰ã‚Œãªã„ã‚ˆã†ã«ã¯ãªã£ã¦ã„ã‚‹ã€‚
keys ã‚’å®šç¾©ã—ãŸå ´åˆã€ä»–ã®ã‚­ãƒ¼ã®è¦ç´ ã¯ null ã«ãªã‚‹ã€‚
ã“ã®å ´åˆã¯ã€password ãŒ null

```form.tsx
  return (
    <>
      <LoginForm onSuccess={onSuccess} keys={["username"]}>
        {(fields) => (
          <>
            {fields.username}
            {fields.password}
            <Button type="submit">Login</Button>
          </>
        )}
      </LoginForm>
    </>
  );
```

ä¸€å¿œã€è€ƒãˆãªãŒã‚‰ä½œã£ãŸã®ã¯è‰¯ã„ã‚‚ã®ã®ã€ ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å›æ•°å¤šã„ã—ã€ å‹ã‚‚ã‚¤ãƒã‚¤ãƒãªçŠ¶æ…‹

## ä»Šå¾Œã€ã—ãŸã„ã“ã¨

### 1. fields ã«ãªã„ã‚­ãƒ¼ã«å¯¾ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’åãã“ã¨

```pages/login.tsx
      <LoginForm onSuccess={onSuccess} keys={["username"]}>
        {(fields) => (
          <>
            {fields.username}
            {fields.password}
            <Button type="submit">Login</Button>
          </>
        )}
      </LoginForm>
```

### 2. ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°æ•°ã®èª¿æ•´

### 3. fieldOptions ã®å‹ãƒã‚§ãƒƒã‚¯

field ã®å€¤ã«ã‚ˆã£ã¦ã€fieldsOptions ã®å‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ãŸã„

```Form.tsx
  const fieldModel: ArgsModelType<FormValues> = {
    username: {
      field: FieldType.Input,
      // â†“ã“ã‚Œã‚‰
      fieldOptions: {
        label: "username",
        // â†“ã“ã†è¨€ã†ã‚‚ã®ã«å¯¾ã—ã¦ã‚¨ãƒ©ãƒ¼ã‚’åã„ã¦æ¬²ã—ã„
        test: 'test'
      },
    },
    password: {
      field: FieldType.Input,
      fieldOptions: {
        type: "password",
        label: "password",
      },
    },
  };

```

## æœ€å¾Œã«

ãœã²ã€ã”å”åŠ›ã„ãŸã ã‘ã‚‹æ–¹ãŒã„ã‚‰ã£ã—ã‚ƒã„ã¾ã—ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã‘ã‚‹ã¨å¹¸ã„ã§ã™ã€‚
ãã£ã¡ã‚Šã—ãŸã‚‚ã®ãŒä½œã‚ŒãŸã‚‰ã€ã€Œè‰¯ã„æ„Ÿã˜ã€ãŒè‰¯ã„æ„Ÿã˜ã«ã§ããã†ãªãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãŒå…¬é–‹ã§ããã†ãªäºˆæ„ŸãŒã—ã¦ã¾ã™ã€‚
